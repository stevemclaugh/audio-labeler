<html>

<head>
  <script src="jquery-3.3.1.slim"></script>
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
  <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>

  <title>Venmo Search</title>
  <!--
### Venmo search Flask app variables ###
# start_date=start_date,
# end_date=end_date,
    ## either entered as text or generated via dropdowns using javascript
# resolution
    ## day, week, or month
# title=title, xlabel=xlabel, ylabel=ylabe
    ## Title and labels to be rendered in plot. Reasonable default if not specified.
-->

</head>

<body>
  <div id="container">
    <div class="title">
      <br /><br />
      <h1></h1>
      <br /><br />
    </div>

    <div id="content">

      <div class="container">

        <div class="plot">


          {% if search_string %}

          <h3 id="progress_count">Progress: 0.0%</h3>
          <img src="{{ url_for('static', filename='plot.png') }}" width=1000 id="plot_img">
          <img src="{{ url_for('static', filename='loading.gif') }}" width=200 id="loading_img">

          <script>
          var plot_img_element = document.getElementById('plot_img');
          var loading_element = document.getElementById('loading_img');
          plot_img_element.src = "{{ url_for('static', filename='plot.png') }}";
          plot_img_element.style.display = "none";

          var counter_element = document.getElementById('progress_count');

          function loadFile(filePath) {
            var result = null;
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", filePath, false);
            xmlhttp.send();
            if (xmlhttp.status==200) {
              result = xmlhttp.responseText;
            }
            return result;
          }


          var counter_value = loadFile("{{ url_for('static', filename='counter.txt') }}");


          setInterval(function() {
              var plot_img_element = document.getElementById('plot_img');
              plot_img_element.src = "{{ url_for('static', filename='plot.png') }}";
              counter_value = loadFile("{{ url_for('static', filename='counter.txt') }}");
              counter_element.innerHTML = "Progress: " + counter_value;
              if(counter_value == "100.0%"){
                plot_img_element.style.display = "block";
                loading_element.style.display = "none";
                counter_element.style.display = "none";
              }
          }, 5000);



          </script>

          {% endif %}



        </div>

<div>

        <form method="post" action="{{ url_for('form') }}">
          <br />

          <h3>Search string</h3>
          <input type="text" size="70" value="{{ search_string }}" name="search_string" />
          <br />


          {% if case_sensitive=='true' %}
            <input type="checkbox" name="case_sensitive" value="true" checked> Case-sensitive<br />
            {% else %}
            <input type="checkbox" name="case_sensitive" value="true"> Case-sensitive<br />
          {% endif %}

          {% if raw_count=='true' %}
            <input type="checkbox" name="raw_count" value="true" checked> Raw count (Proportional use of string is default.)<br />
            {% else %}
            <input type="checkbox" name="raw_count" value="true"> Raw count (Proportional use of string is default.)<br />
          {% endif %}



<br />

          <i>Search string display name (optional)</i><br />
          <input type="text" size="70" value="{{ search_string_name }}" name="search_string_name" />

          <!-- Search string options -->
          <br />

</div>
<div style = 'float:left'>

          <!-- Start and end time -->
          <h3>Start time</h3>
          <!--<input type="number" name="start_date_unix">-->

          <input type="date" name="start_date" value="{{ start_date }}">
          <br />

          <h3>End time</h3>
          <!--<input type="number" name="end_date_unix">-->

          <input type="date" name="end_date" value="{{ end_date }}">
          <br />
</div>

<div style = 'float:left'>
          <h3>Resolution</h3>
          <input type="radio" name="resolution" value="day"> Day<br />
          <input type="radio" name="resolution" value="week"> Week<br />
          <input type="radio" name="resolution" value="month" checked> Month<br />

          <input type="hidden" name="auth_key" value="{{auth_key}}">

          <br />
          <input type="submit" name="button" id="plot_button" value="Plot" />
</div>

        </form>

<p><a href="/static/random_messages.csv">Random messages CSV</a></p>

<!--
        <table>
          {% for item in header %}
            <td style="padding: 15px; text-align: left;">
              <b>{{ item }}</b>
            </td>
          {% endfor %}


        </table>
-->



<script>



</script>



        <br /><br />

      </div>
    </div>
</body>

</html>
